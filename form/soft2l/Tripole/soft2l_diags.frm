#-
#: IncDir procedures
#: SmallExtension 100M
#: WorkSpace      2G
Off Statistics;

Format 160;


****************************************
* diags function choice

#write "specify diagrams to calculate by defining first and last"

****************************************

#include declarations.h
* Read Feynman diagrams generated by diags.cpp (This is just to get the number of diagrams)
#include diagrams/diags.out
.sort
drop;

#write "`ndiags' diagrams for the soft current\n"

#ifndef `first'
#define first "1"
#endif

#ifndef `last'
#define last "`ndiags'"
#endif

.sort
#do i=`first',`last'

*#message d`i' / `ndiags'
* Read the Feynman diagram
#include diagrams/diags.out # d`i'
mul replace_(k1, k1 - q);
sum cOli0,...,cOli20;
sum cOlj0,...,cOlj20;
#do v=1,6
  #do l=0,10
    sum v`v'l`l';
  #enddo
#enddo

* Include factor i for the integration measure ( which is d^d k/(i*pi^(d/2)) )
mul -1;

* Insert Feynman rules
#call FeynmanRules

* Bring color structure to a unique form
#call Color

* Extract singular limit and rewrite propagators to Eikonal propagators
#call SoftLim

*if(count(T1, 1) != 3 || count(T2, 1) != 2) discard;

b cOlT, T1, T2, T3, cOlf, lam, k1, k2, DS, Eik;
print d`i';
.sort

.store
.sort
save results/diags/d`i'.sav d`i';
#enddo

.end